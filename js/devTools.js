/*! dwithease - v1.6.0 - 2017-02-16 */!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(b.dwe||(b.dwe={})).exports=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(){var b=a("./modules/handlers").create("dt");a("./modules/msg").init("dt",b)}()},{"./modules/handlers":4,"./modules/msg":5}],2:[function(a,b,c){function d(a,b){return 0===b?a:a+"_"+b}var e=(a("../libs/constants.js"),"dwe_sandboxes"),f=null;try{f=chrome.storage.sync}catch(a){console.log("could not initiate chrome local storage: "+a)}storage={};var g=function(a,b){"undefined"!=typeof b&&b(a)};storage.get=function(a,b){f.get(a,function(a){g(a,b)})},storage.getSandboxes=function(a){f.get(null,function(b){var c,h=[];for(c=0;c<f.MAX_ITEMS&&void 0!==b[d(e,c)];c++)h.push.apply(h,b[d(e,c)]);g(h,a)})},storage.set=function(a,b){f.set(a,function(a){g(a,b)})},storage.splitArray=function(a,b){if(a){for(var c=a.slice(0),d=[];c.length>0;)d.push(c.splice(0,b));return d}},storage.lengthInUtf8Bytes=function(a){var b=encodeURIComponent(a).match(/%[89ABab]/g);return a.length+(b?b.length:0)},storage.setSandboxes=function(a,b){if(a){for(var c,g,h=0,i={},j=this.splitArray(a,1),h=0;h<j.length;h++)g=d(e,h),c=j[h],i[g]=c;f.set(i,b),f.remove(d(e,h))}},storage.remove=function(a,b){f.remove(a,function(a){g(a,b)})},b.exports=storage},{"../libs/constants.js":3}],3:[function(a,b,c){for(var d="mjgfjtbxftpnfboetpbnj",e="",f=0;f<d.length;f++)e+=28===d.charCodeAt(f)?"&":23===d.charCodeAt(f)?"!":String.fromCharCode(d.charCodeAt(f)-1);var g=function(a){return 0===Object.keys(a).length},h={};h.sandboxNotifId="sandboxNotification",h.donateNotifId="donateNotification",h.wrongPassNotifId="wrongPassword",h.newUpdateNotifId="extensionUpdate",h.generalOptsKey="dwe_general",h.sandboxOptsKey="dwe_sandboxes",h.settingsKey="dwe_settings",h.contextMenuKey="dwe_contextmenu",h.maskedPass="********",h.analyticsCode="UA-68649804-3",h.m=e,h.objectIsEmpty=g,h.defaultSettings={showNotifications:!0,beautifyLogsOptions:"beautify",scrollLogToBottom:!0,trimLogs:!0,trimLogErrors:"200",disableInProduction:!1},h.defaultContextMenu=[{menuName:"Logs",menuUrl:"/on/demandware.servlet/webdav/Sites/Logs/",itemId:1,default:!0,popupClass:"glyphicon glyphicon-list-alt"},{menuName:"BM Home",menuUrl:"/on/demandware.store/Sites-Site/default/ViewApplication-DisplayWelcomePage",itemId:2,default:!0,popupClass:"glyphicon glyphicon-cloud"},{menuName:"Import Export",menuUrl:"/on/demandware.store/Sites-Site/default/ViewCustomizationImpex-Start?SelectedMenuItem=studio&CurrentMenuItemId=studio",itemId:3,default:!0,popupClass:"glyphicon glyphicon-import"},{menuName:"Site Import Export",menuUrl:"/on/demandware.store/Sites-Site/default/ViewApplication-DisplayWelcomePage",itemId:4,default:!0,popupClass:"glyphicon glyphicon-cloud"},{menuName:"User List",menuUrl:"/on/demandware.store/Sites-Site/default/ViewUserList-List?SelectedMenuItem=organization&CurrentMenuItemId=organization",itemId:5,default:!0,popupClass:"glyphicon glyphicon-user"},{menuName:"Development Setup",menuUrl:"/on/demandware.store/Sites-Site/default/ViewStudioSetup-Start?SelectedMenuItem=studio&CurrentMenuItemId=studio",itemId:6,default:!0,popupClass:"glyphicon glyphicon-briefcase"},{menuName:"Impex",menuUrl:"/on/demandware.servlet/webdav/Sites/Impex/",itemId:7,default:!0,popupClass:"glyphicon glyphicon-cloud"}],h.dw_index="demandware.net",h.dw_logoninstance="logoninstance",h.hostnameExists="Hostname already exists",h.hostnameInvalid="Required",b.exports=h},{}],4:[function(a,b,c){var d=(a("../libs/constants.js"),a("../libs/base-storage.js"));b.exports.create=function(a){return{getSandboxes:function(a,b){d.getSandboxes(function(a){b(a)})}}},b.exports.__resetLog=function(){}},{"../libs/base-storage.js":2,"../libs/constants.js":3}],5:[function(a,b,c){function d(a,b){if("function"==typeof b){var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=b(d,a[d],a));return c}}function e(){this.handlers={},this.id=null,this.port=null,this.extPorts={},this.cbTable={},this.pendingReqs={},this.uId=1,this.requestId=1,this.portMap={},this.runtime=h,this.devtools=i}function f(a,b){a.__setRuntime=function(c){return b.runtime=c,a},a.__setDevTools=function(c){return b.devtools=c,a},a.__getId=function(){return b.id},a.__getPort=function(){return b.port},a.__getPortMap=function(){return b.portMap},a.__getHandlers=function(){return b.handlers},a.__getPendingReqs=function(){return b.pendingReqs}}var g=-1e3,h="object"==typeof chrome&&chrome.runtime,i="object"==typeof chrome&&chrome.devtools;e.prototype.selectTargets=function(a,b,c,e,f){var h=[],i=this.portMap[e]&&this.portMap[e][f];return a||i?(a||b!==g||(b=i.tabId),d(this.portMap,function(e,f){c&&-1===c.indexOf(e)||d(f,function(c,d){b&&b!==d.tabId||(a||i.port!==d.port)&&h.push({port:d.port,id:c})})}),h):[]},e.prototype.onCustomMsg=function(a){function b(b){a.sendResponse&&this.port.postMessage({cmd:"response",portId:this.id,reqId:a.reqId,resultValid:!0,result:b})}function c(b){var c=[];return function(e,f){if(f!==!1&&c.push(e),b--,!b&&a.sendResponse&&((d=this.extPorts[a.extensionId])||this.portMap[a.category]&&(d=this.portMap[a.category][a.portId]))){var g={cmd:"response",reqId:a.reqId,result:a.broadcast?c:c[0]};a.extensionId&&(g.extensionId=h.id),d.port.postMessage(g)}}.bind(this)}var d,e,f,g,i;if(a&&a.cmd){if("setName"===a.cmd)return void(this.id=a.name);if("bg"===this.id){if("request"===a.cmd){var j=this.selectTargets(!1,a.tabId,a.contexts,a.category,a.portId),k=j.length;if(void 0!==a.tabId||a.contexts&&-1===a.contexts.indexOf("bg")||(g=this.handlers[a.cmdName])&&"function"==typeof g&&(f=g,k++),k){var l=c.call(this,k);for(i=0;i<j.length;i++)d=j[i],d.port.postMessage({cmd:"request",cmdName:a.cmdName,sendResponse:!0,args:a.args,reqId:this.requestId}),e=this.pendingReqs[d.id]||[],e.push({id:this.requestId,cb:l}),this.pendingReqs[d.id]=e,this.requestId++;f&&(a.args.push(l),f.apply(this.handlers,a.args))}else if(a.sendResponse&&((d=this.extPorts[a.extensionId])||this.portMap[a.category]&&(d=this.portMap[a.category][a.portId]))){var m={cmd:"response",reqId:a.reqId,resultValid:!1,result:a.broadcast?[]:void 0};a.extensionId&&(m.extensionId=h.id),d.port.postMessage(m)}}else if("response"===a.cmd){var n=a.portId||a.extensionId;if(e=this.pendingReqs[n]){for(i=0;i<e.length&&e[i].id!==a.reqId;)i++;i<e.length&&(e[i].cb(a.result,a.resultValid),this.pendingReqs[n].splice(i,1),this.pendingReqs[n].length||delete this.pendingReqs[n])}}else if("updateTabId"===a.cmd){var o=a.context,p=a.portId;(d=this.portMap[o])&&(d=d[p])&&("function"==typeof this.handlers.onDisconnect&&this.handlers.onDisconnect(o,d.tabId),d.tabId=a.tabId,"function"==typeof this.handlers.onConnect&&this.handlers.onConnect(o,d.tabId))}}else"request"===a.cmd?(f=this.handlers[a.cmdName],"function"!=typeof f?a.sendResponse&&this.port.postMessage({cmd:"response",portId:this.id,reqId:a.reqId,resultValid:!1}):(a.args.push(b.bind(this)),f.apply(this.handlers,a.args))):"response"===a.cmd&&this.cbTable[a.reqId]&&(this.cbTable[a.reqId](a.result),delete this.cbTable[a.reqId])}},e.prototype.closePendingReqs=function(a){var b;if(b=this.pendingReqs[a]){for(var c=0;c<b.length;c++)b[c].cb(void 0,!1);delete this.pendingReqs[a]}},e.prototype.registerExternalConnection=function(a,b){function c(){b.onDisconnect.removeListener(e),b.onMessage.removeListener(d),delete this.extPorts[a],this.closePendingReqs(a),"function"==typeof this.handlers.onExtensionDisconnect&&this.handlers.onExtensionDisconnect(a)}this.extPorts[a]={port:b};var d,e;b.onMessage.addListener(d=this.onCustomMsg.bind(this)),b.onDisconnect.addListener(e=c.bind(this)),"function"==typeof this.handlers.onExtensionConnect&&this.handlers.onExtensionConnect(a)},e.prototype.onConnectExternal=function(a){this.extPorts[a.sender.id]||this.registerExternalConnection(a.sender.id,a)},e.prototype.onConnect=function(a){function b(){a.onDisconnect.removeListener(h),a.onMessage.removeListener(g),e=this.portMap[c];var b;e&&(b=e[d])&&(f=b.tabId,delete e[d]),this.closePendingReqs(d),"function"==typeof this.handlers.onDisconnect&&this.handlers.onDisconnect(c,f)}var c=a.name||"unknown",d=c+"-"+this.uId;this.uId++;var e=this.portMap[c]||{},f=a.sender&&a.sender.tab&&a.sender.tab.id||1/0;e[d]={port:a,tabId:f},this.portMap[c]=e;var g,h;a.onMessage.addListener(g=this.onCustomMsg.bind(this)),a.onDisconnect.addListener(h=b.bind(this)),a.postMessage({cmd:"setName",name:d}),"function"==typeof this.handlers.onConnect&&this.handlers.onConnect(c,f)},e.prototype.createMsgObject=function(a){function b(b){function c(a,c){var d=[];return function(e,f){f&&d.push(e),a--,a<=0&&c&&c(b?d:d[0])}}return function d(){if(!arguments.length)return!1;if(!this.id){var e=this,f=arguments;return setTimeout(function(){d.apply(e,f)},1),!0}var g,h,i,j,k=[],l=0,m=arguments.length;for("function"==typeof arguments[m-1]&&(m--,j=arguments[m]);l<m;){var n=arguments[l++];if(void 0===i)switch(typeof n){case"number":if(void 0!==g)return!1;g=n;break;case"object":if("undefined"==typeof n.length||void 0!==h)return!1;h=n;break;case"string":i=n;break;default:return!1}else k.push(n)}if(void 0===i)return!1;if("bg"===this.id){for(var o=this.selectTargets(!0,g,h),p=o.length,q=c.call(this,p,j),r=0;r<o.length;r++){var s=o[r];s.port.postMessage({cmd:"request",cmdName:i,sendResponse:!0,args:k,reqId:this.requestId});var t=this.pendingReqs[s.id]||[];t.push({id:this.requestId,cb:q}),this.pendingReqs[s.id]=t,this.requestId++}o.length||q(null,!1)}else j&&(this.cbTable[this.requestId]=j),this.port.postMessage({cmd:"request",cmdName:i,reqId:this.requestId,sendResponse:void 0!==j,broadcast:b,category:a,portId:this.id,tabId:g,contexts:h,args:k}),this.requestId++;return!0}.bind(this)}function c(){return function(a,b){if(arguments.length<2)return!1;if("bg"!==this.id)return!1;var c,d=Array.prototype.slice.call(arguments,2);"function"==typeof d[d.length-1]&&(c=d.pop());var e=this.extPorts[a];if(!e)return c&&c(),!0;e.port.postMessage({cmd:"request",cmdName:b,sendResponse:!0,args:d,reqId:this.requestId,extensionId:h.id});var f=this.pendingReqs[a]||[];return f.push({id:this.requestId,cb:function(a){c&&c(a)}}),this.pendingReqs[a]=f,this.requestId++,!0}.bind(this)}var d={cmd:b.call(this,!1),bcast:b.call(this,!0)};return"bg"!==a?d.bg=function(){if(0===arguments.length||"string"!=typeof arguments[0])return!1;for(var a=[["bg"]],b=0;b<arguments.length;b++)a.push(arguments[b]);return d.cmd.apply(d,a)}:(d.connectExt=function(a){if(this.extPorts[a])return!0;var b=this.runtime.connect(a);this.registerExternalConnection(a,b)}.bind(this),d.cmdExt=c.call(this)),d},e.prototype.init=function(a,b){function c(){this.port.onDisconnect.removeListener(e),this.port.onMessage.removeListener(f)}function d(){return this.id?void this.port.postMessage({cmd:"updateTabId",context:a,portId:this.id,tabId:g}):void setTimeout(d.bind(this),1)}this.handlers=b||{};var e,f,g;return"bg"===a?(this.id="bg",this.runtime.onConnect.addListener(this.onConnect.bind(this)),this.runtime.onConnectExternal.addListener(this.onConnectExternal.bind(this))):(this.port=this.runtime.connect({name:a}),this.port.onMessage.addListener(f=this.onCustomMsg.bind(this)),this.port.onDisconnect.addListener(e=c.bind(this)),"dt"===a&&this.devtools&&(g=this.devtools.inspectedWindow)&&"number"==typeof(g=g.tabId)&&d.call(this)),this.createMsgObject(a)};var j=new e;b.exports={SAME_TAB:g,init:j.init.bind(j),__allowUnitTests:function(){f(this,j)},__createClone:function(){var a=new e;return a.SAME_TAB=g,f(a,a),a}}},{}]},{},[1])(1)});